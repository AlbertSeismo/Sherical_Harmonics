<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="SHTOOLS subroutines and functions can be accessed easily from any Fortran 95 program. It is only necessary to use the SHTOOLS module and link to the compiled...">
<meta name="keywords" content=" spherical harmonics software package, spherical harmonic transform, legendre functions, multitaper spectral analysis, fortran, Python, gravity, magnetic field">
<title>Using SHTOOLS with Fortran 95 | SHTOOLS - Tools for working with spherical harmonics</title>
<link rel="stylesheet" href="css/syntax.css">

<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="css/modern-business.css">
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<link rel="stylesheet" href="css/customstyles.css">
<link rel="stylesheet" href="css/boxshadowproperties.css">
<!-- most color styles are extracted out to here -->
<link rel="stylesheet" href="css/theme-blue.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="js/jquery.navgoco.min.js"></script>


<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Anchor.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="js/toc.js"></script>
<script src="js/customscripts.js"></script>

<link rel="shortcut icon" href="images/favicon.ico">

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="" href="http://shtools.oca.eu/feed.xml">

    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $("#mysidebar").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 400,
                    easing: 'swing'
                }
            });

            $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    <script>
        $(document).ready(function() {
            $("#tg-sb-link").click(function() {
                $("#tg-sb-sidebar").toggle();
                $("#tg-sb-content").toggleClass('col-md-9');
                $("#tg-sb-content").toggleClass('col-md-12');
                $("#tg-sb-icon").toggleClass('fa-toggle-on');
                $("#tg-sb-icon").toggleClass('fa-toggle-off');
            });
        });
    </script>
    

</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-inverse navbar-static-top">
    <div class="container topnavlinks">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="fa fa-home fa-lg navbar-brand" href="index.html">&nbsp;<span class="projectTitle"> SHTOOLS</span></a>
        </div>
        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
            <ul class="nav navbar-nav navbar-right">
                <!-- toggle sidebar button -->
                <li><a id="tg-sb-link" href="#"><i id="tg-sb-icon" class="fa fa-toggle-on"></i> Nav</a></li>
                <!-- entries without drop-downs appear here -->




                
                
                
                <li><a href="https://github.com/SHTOOLS/SHTOOLS/" target="_blank">GitHub</a></li>
                
                
                
                <li><a href="https://github.com/SHTOOLS/SHTOOLS/wiki" target="_blank">Wiki</a></li>
                
                
                
                <!-- entries with drop-downs appear here -->
                <!-- conditional logic to control which topnav appears for the audience defined in the configuration file.-->
                
                
			<li>



  <a class="email" title="Submit feedback" href="#" onclick="javascript:window.location='mailto:mark.wieczorek@oca.eu?subject=SHTOOLS feedback&body=I have some feedback about Using SHTOOLS with Fortran 95 page: ' + window.location.href;"><i class="fa fa-envelope-o"></i> Feedback</a>

</li>

		
                <!--comment out this block if you want to hide search-->
                <li>
                    <!--start search-->
                    <div id="search-demo-container">
                        <input type="text" id="search-input" placeholder="search...">
                        <ul id="results-container"></ul>
                    </div>
                    <script src="js/jekyll-search.js" type="text/javascript"></script>
                    <script type="text/javascript">
                            SimpleJekyllSearch.init({
                                searchInput: document.getElementById('search-input'),
                                resultsContainer: document.getElementById('results-container'),
                                dataSource: 'search.json',
                                searchResultTemplate: '<li><a href="{url}" title="Using SHTOOLS with Fortran 95">{title}</a></li>',
                    noResultsText: 'No results found.',
                            limit: 10,
                            fuzzy: true,
                    })
                    </script>
                    <!--end search-->
                </li>
            </ul>
        </div>
        </div>
        <!-- /.container -->
</nav>

<!-- Page Content -->
<div class="container">
  <div id="main">
    <!-- Content Row -->
    <div class="row">
        
        
            <!-- Sidebar Column -->
            <div class="col-md-3" id="tg-sb-sidebar">
                

<ul id="mysidebar" class="nav">
  <li class="sidebarTitle">SHTOOLS 4.2</li>
  
  
  
      
  
  <li>
      <a href="#">Getting started</a>
      <ul>
          
          
          
          <li><a href="index.html">Overview</a></li>
          
          
          
          
          
          
          <li><a href="installing.html">Installing</a></li>
          
          
          
          
          
          
          <li class="active"><a href="using-with-f95.html">Using with Fortran 95</a></li>
          
          
          
          
          
          
          <li><a href="using-with-python.html">Using with Python</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Spherical harmonics</a>
      <ul>
          
          
          
          <li><a href="real-spherical-harmonics.html">Real spherical harmonics</a></li>
          
          
          
          
          
          
          <li><a href="complex-spherical-harmonics.html">Complex spherical harmonics</a></li>
          
          
          
          
          
          
          <li><a href="implementation-details.html">Implementation details</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Fortran 95 Routines</a>
      <ul>
          
          
          
          <li><a href="f95-modules.html">Modules</a></li>
          
          
          
          
          
          
          <li><a href="legendre-functions.html">Legendre functions</a></li>
          
          
          
          
          
          
          <li><a href="spherical-harmonic-transforms.html">Spherical harmonic transformations</a></li>
          
          
          
          
          
          
          <li><a href="io.html">I/O, storage, conversions</a></li>
          
          
          
          
          
          
          <li><a href="global-spectral-analysis.html">Global spectral analysis</a></li>
          
          
          
          
          
          
          <li><a href="localized-spectral-analysis.html">Localized spectral analysis</a></li>
          
          
          
          
          
          
          <li><a href="spherical-harmonic-rotations.html">Spherical harmonic rotations</a></li>
          
          
          
          
          
          
          <li><a href="gravity-magnetics.html">Gravity and magnetics</a></li>
          
          
          
          
          
          
          <li><a href="miscellaneous-routines.html">Miscellaneous</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Python components</a>
      <ul>
          
          
          
          <li><a href="python-classes.html">Python classes</a></li>
          
          
          
          
          
          
          <li><a href="python-legendre-functions.html">Legendre functions</a></li>
          
          
          
          
          
          
          <li><a href="python-spherical-harmonic-transforms.html">Spherical harmonic transformations</a></li>
          
          
          
          
          
          
          <li><a href="python-io.html">I/O, storage, conversions</a></li>
          
          
          
          
          
          
          <li><a href="python-spectral-analysis.html">Global and localized spectral analysis</a></li>
          
          
          
          
          
          
          <li><a href="python-spherical-harmonic-rotations.html">Spherical harmonic rotations</a></li>
          
          
          
          
          
          
          <li><a href="python-gravity-magnetics.html">Gravity and magnetics</a></li>
          
          
          
          
          
          
          <li><a href="python-utilities.html">Utilities</a></li>
          
          
          
          
          
          
          <li><a href="python-constants.html">Constants</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Examples programs</a>
      <ul>
          
          
          
          <li><a href="python-examples.html">Python examples</a></li>
          
          
          
          
          
          
          <li><a href="fortran-examples.html">Fortran 95 examples</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Support</a>
      <ul>
          
          
          
          <li><a href="faq.html">FAQ</a></li>
          
          
          
          
          
          
          <li><a href="fortran-95-problems.html">Fortran 95 problems</a></li>
          
          
          
          
          
          
          <li><a href="how-to-contribute.html">How to contribute</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#">Release Notes</a>
      <ul>
          
          
          
          <li><a href="release-notes-v4.html">Version 4</a></li>
          
          
          
          
          
          
          <li><a href="release-notes-v3.html">Version 3</a></li>
          
          
          
          
          
          
          <li><a href="license.html">License</a></li>
          
          
          
          
          
          
          <li><a href="contributors.html">Contributors</a></li>
          
          
          
          
      </ul>
   </li>
     
      
      
      <!-- if you aren't using the accordion, uncomment this block:
         <p class="external">
             <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
         </p>
         -->
</ul>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

            </div>
            
        

        <!-- Content Column -->
        <div class="col-md-9" id="tg-sb-content">
            <script type="text/x-mathjax-config">
MathJax.Hub.Config({
  TeX: { equationNumbers: { autoNumber: "AMS" } }
});
</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  displayAlign: "left",
  displayIndent: "2em"
});
</script>

<script type="text/javascript" async
 src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

<div class="post-header">
   <h1 class="post-title-main">Using SHTOOLS with Fortran 95</h1>
</div>



<div class="post-content">

   
    <div class="summary">SHTOOLS subroutines and functions can be accessed easily from any Fortran 95 program. It is only necessary to use the SHTOOLS module and link to the compiled archive.</div>
   

    
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.

$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h2,h3,h4' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = $(this.getAttribute('href'))
    , scroll_target = target.offset().top

  $(window).scrollTop(scroll_target - 10);
  return false
})
  
});
</script>

<div id="toc"></div>

    

  <h2 id="calling-shtools-routines">Calling SHTOOLS routines</h2>

<p>To access the SHTOOLS functions and subroutines in your code, it is necessary to place the statement</p>
<div class="language-fortran highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">use</span><span class="w"> </span><span class="n">SHTOOLS</span><span class="w">
</span></code></pre></div></div>
<p>directly after the program, subroutine, or function declaration (i.e., before an <code class="highlighter-rouge">implicit none</code> statement). The SHTOOLS module contains an interface block that declares the subroutines and functions used in this archive and allows for the use of implicitly shaped arrays. It should be noted that all arrays passed to a subroutine or function can be <em>larger</em> than that specified in the documentation.</p>

<h2 id="linking-to-the-shtools-library">Linking to the SHTOOLS library</h2>

<p>When compiling a code that references SHTOOLS, it will be necessary to link to the SHTOOLS library and module files. For this purpose, it may be useful to define the environment variables <code class="highlighter-rouge">SHTOOLSMODPATH</code> and <code class="highlighter-rouge">SHTOOLSLIBPATH</code> using the default file locations. In a C-shell, this is accomplished using</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>setenv SHTOOLSLIBPATH <span class="o">=</span> <span class="s2">"/usr/local/lib"</span>
setenv SHTOOLSMODPATH <span class="o">=</span> <span class="s2">"/usr/local/include"</span>
</code></pre></div></div>
<p>whereas for a bash shell the syntax is</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">export </span>SHTOOLSLIBPATH <span class="o">=</span> <span class="s2">"/usr/local/lib"</span>
<span class="nb">export </span>SHTOOLSMODPATH <span class="o">=</span> <span class="s2">"/usr/local/include"</span>
</code></pre></div></div>
<p>In addition, most routines require linking to the fast Fourier transform package <a href="http://www.fftw.org">FFTW</a>, and the linear algebra packages <a href="http://www.netlib.org/lapack/">LAPACK</a> and <a href="http://www.netlib.org/blas/">BLAS</a>. Typical examples of compiling and linking a program <code class="highlighter-rouge">MyProgram.f95</code> to the necessary library and module files are given below for several common compilers.</p>

<h3 id="gfortran">gfortran</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gfortran MyProgram.f95 <span class="nt">-I</span><span class="nv">$SHTOOLSMODPATH</span> <span class="nt">-L</span><span class="nv">$SHTOOLSLIBPATH</span> <span class="nt">-lSHTOOLS</span> <span class="nt">-lfftw3</span> <span class="nt">-lm</span> <span class="nt">-llapack</span> <span class="nt">-lblas</span> <span class="nt">-O3</span> <span class="nt">-m64</span> <span class="nt">-o</span> MyProgram
</code></pre></div></div>

<h3 id="absoft-pro-fortran-f95">Absoft Pro Fortran (f95)</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>f95 MyProgram.f95 <span class="nt">-p</span> <span class="nv">$SHTOOLSMODPATH</span> <span class="nt">-L</span><span class="nv">$SHTOOLSLIBPATH</span> <span class="nt">-YEXT_NAMES</span><span class="o">=</span>LCS <span class="nt">-YEXT_SFX</span><span class="o">=</span>_ <span class="nt">-lSHTOOLS</span> <span class="nt">-lfftw3</span> <span class="nt">-lm</span> <span class="nt">-llapack</span> <span class="nt">-lblas</span> <span class="nt">-O3</span> <span class="nt">-m64</span> <span class="nt">-o</span> MyProgram
</code></pre></div></div>

<h3 id="g95">g95</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>g95 MyProgram.f95 <span class="nt">-I</span><span class="nv">$SHTOOLSMODPATH</span> <span class="nt">-L</span><span class="nv">$SHTOOLSLIBPATH</span> <span class="nt">-fno-second-underscore</span> <span class="nt">-lSHTOOLS</span> <span class="nt">-lfftw3</span> <span class="nt">-lm</span> <span class="nt">-llapack</span> <span class="nt">-lblas</span> <span class="nt">-O3</span> <span class="nt">-m64</span> <span class="nt">-o</span> MyProgram
</code></pre></div></div>

<h3 id="intel-fortran-ifort">Intel Fortran (ifort)</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ifort <span class="nt">-fpp</span> <span class="nt">-free</span> <span class="nt">-I</span><span class="nv">$SHTOOLSMODPATH</span> <span class="nt">-L</span><span class="nv">$SHTOOLSLIBPATH</span> <span class="nt">-lSHTOOLS</span> <span class="nt">-lfftw3</span> <span class="nt">-lm</span> <span class="nt">-llapack</span> <span class="nt">-lblas</span> <span class="nt">-O3</span> <span class="nt">-m64</span> <span class="nt">-Tf</span> MyProgram.f95 <span class="nt">-o</span> MyProgram
</code></pre></div></div>
<p>Note that the position of the source file in the above examples might be important for some compilers. It may be necessary to modify some options in order to properly link to both the LAPACK and FFTW libraries (see <a href="installing.html">installing SHTOOLS</a> for more details). If the library ATLAS exists on your system, this could be used instead of BLAS.</p>

<h2 id="openmp">OpenMP</h2>
<p>The Fortran 95 routines in the OpenMP version of SHTOOLS are OpenMP compatible and OpenMP thread-safe. To use these routines in a program that uses OpenMP, it is necessary to link to the library <code class="highlighter-rouge">libSHTOOLS-mp.a</code> and to add one of the following compiler options:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">-fopenmp</span>  <span class="c"># gfortran</span>
<span class="nt">-openmp</span>  <span class="c"># Absoft Pro Fortran</span>
<span class="nt">-qopenmp</span>  <span class="c"># ifort</span>
</code></pre></div></div>

<h2 id="fortran-array-indices">Fortran array indices</h2>
<p>Fortran arrays usually start with an index of 1. However, with spherical harmonic functions and coefficients a degree-0 term exists. In order to deal with this, all arrays that are a function of spherical harmonic degree <code class="highlighter-rouge">l</code> and order <code class="highlighter-rouge">m</code> have 1 added to each of their indices. For instance, the real Fortran array <code class="highlighter-rouge">clm</code> is related to the spherical harmonic coefficients <script type="math/tex">C_{lm}</script> by</p>

<script type="math/tex; mode=display">% <![CDATA[
C_{lm} = \left \lbrace
\begin{array}{ll}
\mbox{clm}(1,l+1,m+1)  & \mbox{if } m\ge 0 \\
\mbox{clm}(2,l+1,m+1)  & \mbox{if } m < 0.\\
\end{array}
\right. %]]></script>

<p>In this notation, the positive and negative angular orders correspond to the cosine and sine coefficients, respectively (see the page <a href="real-spherical-harmonics.html">real spherical harmonics</a> for more information).</p>

<h2 id="using-optional-parameters">Using optional parameters</h2>
<p>Many of the subroutines and functions in this archive can accept one or more optional parameters. To specify these parameters, it is only necessary to use the syntax</p>
<div class="language-fortran highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">call</span><span class="w"> </span><span class="n">SHRead</span><span class="w"> </span><span class="p">(</span><span class="n">FILENAME</span><span class="p">,</span><span class="w"> </span><span class="n">CILM</span><span class="p">,</span><span class="w"> </span><span class="n">LMAX</span><span class="p">,</span><span class="w"> </span><span class="n">SKIP</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">ERROR</span><span class="o">=</span><span class="n">errorcoef</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>
<p>where <code class="highlighter-rouge">SKIP</code> and <code class="highlighter-rouge">ERROR</code> are the names of two optional parameters, and the constant <code class="highlighter-rouge">1</code> and variable <code class="highlighter-rouge">errorcoef</code> are their respective arguments.</p>

<h2 id="documentation">Documentation</h2>

<p>Documentation for the Fortran 95 subroutines and functions in SHTOOLS can be accessed by their unix man pages, using all lower case letters. As an example, to access the <code class="highlighter-rouge">MakeGridDH</code> man page, use</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>man makegriddh
</code></pre></div></div>
<p>Alternatively, the man pages can be accessed from the <em>Fortran 95 Routines</em> menu on this web site.</p>


    <div class="tags">
        
    </div>

    

    <a target="_blank" href="https://github.com/SHTOOLS/SHTOOLS/blob/develop/docs/pages/mydoc/using-with-f95.md" class="btn btn-default githubEditButton" role="button"><i class="fa fa-github fa-lg"></i> Edit me</a>

    

</div>

<hr class="shaded"/>

<footer>
            <div class="row">
                <div class="col-lg-12 footer">
               &copy;2018 SHTOOLS. All rights reserved. <br />
<a href="https://www.oca.eu/?lang=en" target="_blank" rel="noopener">Observatoire de la Côte d'Azur</a><br />
<a href="https://lagrange.oca.eu/fr/accueil-lagrange" target="_blank" rel="noopener">Laboratoire Lagrange</a><br />
<p><img src="images/company_logo.png" alt="SHTOOLS"/></p>
                </div>
            </div>
</footer>


        </div>
    <!-- /.row -->
</div>
<!-- /.container -->
</div>
<!-- /#main -->
    </div>

</body>

</html>
